<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English-Hebrew Quiz with Mini-Games</title>
  <style>
    body { font-family: Arial, sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; margin:0; background: linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); overflow:hidden; }
    .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); width:300px; margin:20px; display:none; text-align:center; }
    #loading { font-size:18px; color:#555; }
    #word { font-size:24px; margin-bottom:15px; cursor:pointer; }
    .option, .rps-option, .memory-card, .mole { margin:20px auto; display:block; border:none; border-radius:4px; width:100%; font-size:18px; cursor:pointer; text-align:center; }
    #score { margin-top:10px; font-size:18px; }
    #rps-options, #memory-grid, #wam-grid { display:flex; flex-wrap:wrap; justify-content:space-around; }
    canvas { cursor:pointer; }
    #rps-result, #memory-result, #wam-result { font-size:20px; font-weight:bold; margin-top:10px; }
    .particle { position:absolute; border-radius:50%; animation:firework 1s ease-out forwards; }
    @keyframes firework { 0%{transform:translateY(0) scale(0.5);opacity:1;}100%{transform:translateY(-200px) scale(2);opacity:0;} }
    #fireworks-overlay { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden; z-index:1000; }
  </style>
</head>
<body>
  <div id="loading">Loading quiz...</div>
  <div id="quiz-container" class="container">
    <div id="word" title="Click to replay pronunciation"></div>
    <div id="options"></div>
    <div id="score">Score: 0 / 0</div>
  </div>
  <div id="rps-container" class="container">
    <h2>Rock Paper Scissors!</h2>
    <div id="rps-options"></div>
    <div id="rps-result"></div>
    <button id="rps-continue">Continue Quiz</button>
  </div>
  <div id="memory-container" class="container">
    <h2>Memory Match!</h2>
    <div id="memory-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;"></div>
    <div id="memory-result"></div>
    <button id="memory-continue">Continue Quiz</button>
  </div>
  <div id="wam-container" class="container">
    <h2>Whack-a-Mole!</h2>
    <div id="wam-grid" style="display:flex;justify-content:space-around;"></div>
    <div id="wam-result"></div>
    <button id="wam-continue">Continue Quiz</button>
  </div>
  <audio id="rps-music" src="./war_game4.mp3" loop preload="auto"></audio>
  <script>
    function randInt(n){return Math.floor(Math.random()*n)}
    function shuffle(a){for(let i=a.length-1;i>0;i--){let j=randInt(i+1);[a[i],a[j]]=[a[j],a[i]];}}
    function speak(t){if(!speechSynthesis)return;let u=new SpeechSynthesisUtterance(t);u.lang='en-US';speechSynthesis.speak(u);}
    function showFireworks(){const o=document.createElement('div');o.id='fireworks-overlay';document.body.append(o);for(let i=0;i<20;i++){const p=document.createElement('div');p.className='particle';let s=randInt(8)+8;p.style.width=p.style.height=s+'px';p.style.left=randInt(window.innerWidth)+'px';p.style.top=window.innerHeight+'px';p.style.backgroundColor=`hsl(${randInt(360)},70%,60%)`;o.append(p);}setTimeout(()=>o.remove(),1000);}
    let dictionary=[],score=0,totalQuestions=0,current;
    fetch('dictionary.json').then(r=>{if(!r.ok)throw 0;return r.json()}).then(d=>{dictionary=d;initQuiz()}).catch(e=>{console.error(e);document.getElementById('loading').textContent='Failed to load dictionary.'});
    const sheet=new Image();sheet.src='./file_00000000d81c61f79688983c0590d134.png';let cellW,cellH;sheet.onload=()=>{cellW=sheet.naturalWidth/3;cellH=sheet.naturalHeight/4;};
    const loadingEl=document.getElementById('loading'),quizEl=document.getElementById('quiz-container'),wordEl=document.getElementById('word'),optsEl=document.getElementById('options'),scoreEl=document.getElementById('score');
    const rpsEl=document.getElementById('rps-container'),rpsOpts=document.getElementById('rps-options'),rpsRes=document.getElementById('rps-result'),rpsCont=document.getElementById('rps-continue');
    const memEl=document.getElementById('memory-container'),memGrid=document.getElementById('memory-grid'),memRes=document.getElementById('memory-result'),memCont=document.getElementById('memory-continue');
    const wamEl=document.getElementById('wam-container'),wamGrid=document.getElementById('wam-grid'),wamRes=document.getElementById('wam-result'),wamCont=document.getElementById('wam-continue');
    const rpsMusic=document.getElementById('rps-music');
    function initQuiz(){loadingEl.style.display='none';quizEl.style.display='block';wordEl.onclick=()=>speak(current.en);rpsCont.onclick=resumeQuiz;memCont.onclick=resumeQuiz;wamCont.onclick=resumeQuiz;nextQuestion();}
    function nextQuestion(){current=dictionary[randInt(dictionary.length)];wordEl.textContent=current.en;speak(current.en);let choices=[current.he];let others=dictionary.filter(w=>w.he!==current.he);shuffle(others);choices.push(...others.slice(0,6).map(w=>w.he));shuffle(choices);const cols=choices.map((_,i)=>`hsl(${Math.round(i*360/choices.length)},70%,80%)`);shuffle(cols);optsEl.innerHTML='';choices.forEach((c,i)=>{let b=document.createElement('button');b.className='option';b.textContent=c;b.style.backgroundColor=cols[i];b.onclick=()=>handleAnswer(c);optsEl.append(b)});scoreEl.textContent=`Score: ${score} / ${totalQuestions}`;quizEl.style.display='block';rpsEl.style.display='none';memEl.style.display='none';wamEl.style.display='none';}
    function handleAnswer(c){totalQuestions++;if(c===current.he){score++;speak('correct');showFireworks();if(score%5===0)return startMiniGame();setTimeout(nextQuestion,500);}else{alert(`Incorrect. Correct: ${current.he}`);setTimeout(nextQuestion,0);}scoreEl.textContent=`Score: ${score} / ${totalQuestions}`;}
    function startMiniGame(){quizEl.style.display='none';const games=['rps','memory','wam'];const choice=games[randInt(3)];if(choice==='rps')startRPS();else if(choice==='memory')startMemory();else startWAM();}
    function resumeQuiz(){rpsMusic.pause();rpsMusic.currentTime=0;rpsEl.style.display='none';memEl.style.display='none';wamEl.style.display='none';quizEl.style.display='block';nextQuestion();}
    function startRPS(){rpsOpts.innerHTML='';rpsRes.textContent='';rpsEl.style.display='block';rpsMusic.play();['rock','paper','scissors'].forEach((w,i)=>{let c=document.createElement('canvas');c.width=c.height=64;if(cellW){let ctx=c.getContext('2d');ctx.drawImage(sheet,i*cellW,0,cellW,cellH,0,0,64,64);}c.className='rps-option';c.onclick=()=>rpsChoice(w);rpsOpts.append(c)});}
    function rpsChoice(u){let ui=['rock','paper','scissors'].indexOf(u),ci=randInt(3),cw=['rock','paper','scissors'][ci];let res=(ui===ci?'Tie':(u==='rock'&&cw==='scissors'||u==='paper'&&cw==='rock'||u==='scissors'&&cw==='paper')?'You won!':'You lost!');rpsOpts.innerHTML='';displayCanvas(0,ui);displayCanvas(1,ci);rpsRes.textContent=res;speak(res);if(res==='You won!')showFireworks();}
    function displayCanvas(r,c){const d=document.createElement('div'),cv=document.createElement('canvas');cv.width=cv.height=64;const ctx=cv.getContext('2d');ctx.drawImage(sheet,c*cellW,r*cellH,cellW,cellH,0,0,64,64);d.append(cv);rpsOpts.append(d);}
    function startMemory() {
      memGrid.innerHTML = '';
      memRes.textContent = '';
      memEl.style.display = 'block';
      rpsMusic.play();// Prepare a deck with both user and computer images (2 rows Ã— 3 cols)
  let cards = [];
  for (let row = 0; row < 2; row++) {
    for (let col = 0; col < 3; col++) {
      cards.push({ row, col });
      cards.push({ row, col });
    }
  }
  shuffle(cards);
  let firstCard = null;
  let matched = 0;

  cards.forEach(({ row, col }) => {
    const cv = document.createElement('canvas');
    cv.width = cv.height = 64;
    cv.className = 'memory-card';
    cv.dataset.row = row;
    cv.dataset.col = col;
    cv.dataset.flipped = 'false';
    cv.onclick = () => flipCard(cv);
    memGrid.appendChild(cv);
  });

  function flipCard(canvas) {
    if (canvas.dataset.flipped === 'true') return;
    const ctx = canvas.getContext('2d');
    const row = +canvas.dataset.row;
    const col = +canvas.dataset.col;
    // Show image
    ctx.clearRect(0, 0, 64, 64);
    ctx.drawImage(sheet, col * cellW, row * cellH, cellW, cellH, 0, 0, 64, 64);
    canvas.dataset.flipped = 'true';

    if (!firstCard) {
      firstCard = canvas;
    } else {
      const fRow = +firstCard.dataset.row;
      const fCol = +firstCard.dataset.col;
      if (fRow === row && fCol === col) {
        matched += 2;
        firstCard = null;
        if (matched === cards.length) {
          memRes.textContent = 'All matched!';
          speak('Well done');
          showFireworks();
        }
      } else {
        setTimeout(() => {
          // Hide both cards
          firstCard.getContext('2d').clearRect(0, 0, 64, 64);
          firstCard.dataset.flipped = 'false';
          ctx.clearRect(0, 0, 64, 64);
          canvas.dataset.flipped = 'false';
          firstCard = null;
        }, 700);
      }
    }
  }
}function startWAM(){wamGrid.innerHTML='';wamRes.textContent='';wamEl.style.display='block';rpsMusic.play();for(let i=0;i<3;i++){const h=document.createElement('div');h.style.width=h.style.height='64px';wamGrid.append(h);}let rounds=10,count=0;const iv=setInterval(()=>{if(count++>=rounds){clearInterval(iv);wamRes.textContent='Game over';speak('Game over');return;}Array.from(wamGrid.children).forEach(h=>h.innerHTML='');const idx=randInt(3),v=randInt(3),hole=wamGrid.children[idx],cv=document.createElement('canvas');cv.width=cv.height=64;const ctx=cv.getContext('2d');ctx.drawImage(sheet,v*cellW,0,cellW,cellH,0,0,64,64);cv.className='mole';cv.onclick=()=>{speak('hit');showFireworks();hole.innerHTML='';};hole.append(cv);},800);}

  </script>
</body>
</html>
